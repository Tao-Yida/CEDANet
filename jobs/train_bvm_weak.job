#!/bin/bash

# ----------- SLURM æŒ‡ä»¤ï¼ˆä¿ç•™å¿…è¦éƒ¨åˆ†ï¼‰ ------------
#SBATCH --job-name=train_bvm_semi_supervised
#SBATCH --partition=gpu_mig
#SBATCH --gres=gpu:1
#SBATCH --time=24:00:00
#SBATCH --mem=24G
#SBATCH --cpus-per-task=6
#SBATCH --output=../logs_out/trans_bvm_semi_train_%j.out
#SBATCH --error=../logs_err/trans_bvm_semi_train_%j.err



# åŠ è½½æ‰§è¡Œç¯å¢ƒ
module purge
module load 2024
source ~/anaconda3/etc/profile.d/conda.sh
source activate dl2024 || { echo "Failed to activate Conda env"; exit 1; }

# åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•
cd "$(dirname "$0")/.."

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p logs_out logs_err

# æ‰§è¡ŒåŠç›‘ç£è®­ç»ƒè„šæœ¬
#
# å®éªŒé…ç½®ï¼šSMOKE5Kæ ‡æ³¨æ•°æ®(å®Œæ•´è®­ç»ƒ) + ijmondä¼ªæ ‡ç­¾æ•°æ®(è®­ç»ƒ+ç›®æ ‡åŸŸéªŒè¯)
# ğŸ¯ å…³é”®ä¿®æ”¹ï¼šéªŒè¯åœ¨ç›®æ ‡åŸŸ(ijmond)ä¸Šè¿›è¡Œï¼Œè€ŒéæºåŸŸ(SMOKE5K)
python src/bvm_training/trans_bvm_self_supervised/train.py \
--epoch 100 \
--batchsize 8 \
--trainsize 352 \
--lr_gen 5e-5 \
--labeled_dataset_path "data/SMOKE5K_Dataset/SMOKE5K/train" \
--unlabeled_dataset_path "data/ijmond_camera/SMOKE5K-full/non_constraint" \
--save_model_path "models/semi-supervision/SMOKE5K-ijmond-camera-on-SMOKE5K" \
--no_samples 500 \
--aug \
--enable_validation \
--val_split 0.2 \
--patience 25 \
--min_delta 0.001 \
--random_seed 422