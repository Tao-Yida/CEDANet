#!/bin/bash

# ----------- SLURM 指令（保留必要部分） ------------
#SBATCH --job-name=test_bvm_semi_supervised
#SBATCH --partition=gpu_h100
#SBATCH --gres=gpu:1
#SBATCH --time=01:00:00
#SBATCH --mem=16G
#SBATCH --cpus-per-task=4
#SBATCH --output=logs_out/_crop_semi_test_%j.out
#SBATCH --error=logs_err/_crop_semi_test_%j.err

# ============================================================================
# BVM 半监督模型测试脚本
# ============================================================================
# 用途：测试半监督训练后的模型性能
# 模型：使用标注数据+无标注数据训练的半监督模型
# 评估：在SMOKE5K测试集上评估模型表现
# 输出：保存预测结果图像和详细评估报告
# ============================================================================

# 创建日志目录
mkdir -p logs_out logs_err

# 加载执行环境
module purge
module load 2024
source ~/anaconda3/etc/profile.d/conda.sh
source activate dl2024 || { echo "Failed to activate Conda env"; exit 1; }

# 执行半监督模型测试
# --model_path: 半监督训练后的模型路径
# --test_dataset: 测试数据集 (smoke5k)
python ijmond-camera-ai/bvm_training/trans_bvm_self_supervised/test.py \
--model_path models/semi-supervision/SMOKE5K-ijmond-camera-on-SMOKE5K/SMOKE5K_Dataset_SMOKE5K_train_ssl_ijmond_camera_SMOKE5K-full_citizen_constraint/SMOKE5K_Dataset_SMOKE5K_train_ssl_ijmond_camera_SMOKE5K-full_citizen_constraint_epoch_020_from_scratch.pth \
--test_dataset ijmond \